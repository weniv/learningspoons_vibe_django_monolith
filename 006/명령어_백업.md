# Django 블로그 웹 애플리케이션 구축 명령어 (CBV 버전)

## 목차
1. [초기 세팅](#초기-세팅)
2. [프로젝트 기본 설정](#프로젝트-기본-설정)
3. [앱 생성 및 등록](#앱-생성-및-등록)
4. [모델 작성 및 마이그레이션](#모델-작성-및-마이그레이션)
5. [관리자 페이지 설정](#관리자-페이지-설정)
6. [폼 작성](#폼-작성)
7. [뷰 작성 (CBV)](#뷰-작성-cbv)
8. [URL 설정](#url-설정)
9. [템플릿 작성](#템플릿-작성)
10. [마크다운 지원 설정](#마크다운-지원-설정)
11. [정적 파일 설정](#정적-파일-설정)
12. [최종 테스트](#최종-테스트)

---

## 초기 세팅

### 1. 가상환경 생성 및 활성화 (Windows)
```bash
python -m venv venv
.\venv\Scripts\activate
```

### 2. Django 및 필수 패키지 설치
```bash
pip install django
pip install markdown
```

### 3. Django 프로젝트 생성
```bash
django-admin startproject config .
```

---

## 프로젝트 기본 설정

### 1. settings.py 기본 설정
```python
# config/settings.py

# 호스트 설정
ALLOWED_HOSTS = ["*"]

# 로그인/로그아웃 리다이렉트 설정, views.py에서 사용 가능
# 아래와 같이 import 해서 사용할 수도 있습니다. 그냥 문자열일 뿐이에요.
# import settings
# settings.LOGIN_URL

LOGIN_URL = '/accounts/login/'
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/'
```

### 2. 초기 마이그레이션 및 서버 실행
```bash
python manage.py migrate
python manage.py runserver
```

브라우저에서 http://127.0.0.1:8000/ 접속하여 Django 초기 화면 확인

---

## 앱 생성 및 등록
* main, blog, accounts 앱으로 3개 분할하여 구현하는 것이 일반적입니다. 그리고 지금 아래 예제는 AI가 작성한 코드인데, CSS 코드가 너무 많습니다. 그래서 tailwind와 같은 것으로 코드 분량을 줄여서 공부하시는 것을 권해드립니다.

### 1. main 앱 생성
```bash
python manage.py startapp main
```

### 2. accounts 앱 생성 (인증 관련)
```bash
python manage.py startapp accounts
```

### 3. settings.py에 앱 등록
```python
# config/settings.py

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'main',      # 추가
    'accounts',  # 추가
]
```

---

## 모델 작성 및 마이그레이션

### 1. Tag 모델 작성
```python
# main/models.py
from django.db import models
from django.contrib.auth.models import User
from django.utils.text import slugify


class Tag(models.Model):
    name = models.CharField(max_length=50, unique=True, verbose_name='태그명')
    slug = models.SlugField(max_length=50, unique=True, verbose_name='슬러그')
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='생성일')

    class Meta:
        ordering = ['name']
        verbose_name = '태그'
        verbose_name_plural = '태그 목록'

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if not self.slug:
            self.slug = slugify(self.name, allow_unicode=True)
        super().save(*args, **kwargs)

    def get_absolute_url(self):
        from django.urls import reverse
        return reverse('main:post_by_tag', kwargs={'slug': self.slug})
```

### 2. Post 모델 작성
```python
# main/models.py에 추가

class Post(models.Model):
    title = models.CharField(max_length=200, verbose_name='제목')
    content = models.TextField(verbose_name='내용')
    author = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='posts',
        verbose_name='작성자'
    )
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='작성일')
    updated_at = models.DateTimeField(auto_now=True, verbose_name='수정일')
    is_published = models.BooleanField(default=True, verbose_name='공개 여부')
    tags = models.ManyToManyField(
        Tag,
        related_name='posts',
        blank=True,
        verbose_name='태그'
    )

    class Meta:
        ordering = ['-created_at']
        verbose_name = '게시글'
        verbose_name_plural = '게시글 목록'

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        from django.urls import reverse
        return reverse('main:post_detail', kwargs={'pk': self.pk})
```

### 3. Comment 모델 작성
```python
# main/models.py에 추가

class Comment(models.Model):
    post = models.ForeignKey(
        Post,
        on_delete=models.CASCADE,
        related_name='comments',
        verbose_name='게시글'
    )
    author = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='comments',
        verbose_name='작성자'
    )
    content = models.TextField(verbose_name='댓글 내용')
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='작성일')
    updated_at = models.DateTimeField(auto_now=True, verbose_name='수정일')

    class Meta:
        ordering = ['created_at']
        verbose_name = '댓글'
        verbose_name_plural = '댓글 목록'

    def __str__(self):
        return f'{self.author.username}: {self.content[:20]}'

    def get_absolute_url(self):
        return self.post.get_absolute_url()
```

### 4. 마이그레이션 실행
```bash
python manage.py makemigrations
python manage.py migrate
```

---

## 관리자 페이지 설정

### 1. 관리자 계정 생성
```bash
python manage.py createsuperuser
# 예시:
# Username: admin
# Email: admin@example.com
# Password: admin1234!
```

### 2. admin.py 설정
```python
# main/admin.py
from django.contrib import admin
from .models import Post, Tag, Comment

@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['title', 'author', 'is_published', 'created_at']
    list_filter = ['is_published', 'created_at', 'tags']
    search_fields = ['title', 'content']
    prepopulated_fields = {}
    filter_horizontal = ['tags']

@admin.register(Tag)
class TagAdmin(admin.ModelAdmin):
    list_display = ['name', 'slug', 'created_at']
    search_fields = ['name']
    prepopulated_fields = {'slug': ('name',)}

@admin.register(Comment)
class CommentAdmin(admin.ModelAdmin):
    list_display = ['author', 'post', 'content', 'created_at']
    list_filter = ['created_at']
    search_fields = ['content', 'author__username']
```

### 3. 관리자 페이지 접속 및 테스트 데이터 입력
```
http://127.0.0.1:8000/admin
```

**테스트 데이터 예시**:
1. Tag 생성: `Django`, `Python`, `웹개발`
2. Post 생성: 제목과 내용 입력, 태그 연결, is_published 체크
3. Comment 생성: 게시글에 댓글 작성

---

## 폼 작성

1. 해킹 공격 방어를 위해 Django의 ModelForm을 사용합니다.
2. 폼 위젯과 라벨 등을 커스터마이징, HTML에서 쉽게 불러오기 위해 Django의 forms.py를 작성합니다.
3. 유효성 검사도 자동 또는 커스터마이징 가능합니다.

### 1. forms.py 파일 생성 및 PostForm 작성
```python
# main/forms.py
from django import forms
from .models import Post, Comment

class PostForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ['title', 'content', 'tags', 'is_published']
        widgets = {
            'title': forms.TextInput(attrs={
                'class': 'form-control',
                'placeholder': '제목을 입력하세요'
            }),
            'content': forms.Textarea(attrs={
                'class': 'form-control',
                'rows': 15,
                'placeholder': '마크다운 형식으로 작성 가능합니다'
            }),
            'tags': forms.CheckboxSelectMultiple(),
            'is_published': forms.CheckboxInput(attrs={
                'class': 'form-check-input'
            }),
        }
        labels = {
            'title': '제목',
            'content': '내용',
            'tags': '태그',
            'is_published': '공개',
        }
```

### 2. CommentForm 작성
```python
# main/forms.py에 추가

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = ['content']
        widgets = {
            'content': forms.Textarea(attrs={
                'class': 'form-control',
                'rows': 3,
                'placeholder': '댓글을 입력하세요'
            }),
        }
        labels = {
            'content': '댓글',
        }
```

---

## 뷰 작성 (CBV)

### 1. main 앱 뷰 작성 (기본 페이지)
```python
# main/views.py
from django.views.generic import TemplateView, ListView, DetailView, CreateView, UpdateView, DeleteView
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.shortcuts import get_object_or_404
from django.urls import reverse_lazy
from .models import Post, Tag, Comment
from .forms import PostForm, CommentForm

# 기본 페이지
class HomeView(TemplateView):
    template_name = 'main/home.html'

# FBV였으면 아래와 같이 작성됩니다. CBV는 아래와 비슷한 코드 + @입니다.
# def home(request):
#     return render(request, 'main/home.html')

class AboutView(TemplateView):
    template_name = 'main/about.html'

class ContactView(TemplateView):
    template_name = 'main/contact.html'

# 게시글 목록
# 이것을 FBV로 작성하면 매우 길어집니다. 30줄 이상 될 수 있습니다.
class PostListView(ListView):
    model = Post
    template_name = 'blog/post_list.html'
    context_object_name = 'posts'
    paginate_by = 10

    def get_queryset(self):
        return Post.objects.filter(
            is_published=True
        ).select_related('author').prefetch_related('tags')

# 게시글 상세
class PostDetailView(DetailView):
    model = Post
    template_name = 'blog/post_detail.html'
    context_object_name = 'post'

    def get_queryset(self):
        return Post.objects.filter(
            is_published=True
        ).select_related('author').prefetch_related('tags', 'comments__author')

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['comment_form'] = CommentForm()
        return context

# 게시글 작성
# LoginRequiredMixin, CreateView 순서가 중요합니다. 바뀌면 안됩니다.
class PostCreateView(LoginRequiredMixin, CreateView):
    model = Post
    form_class = PostForm
    template_name = 'blog/post_form.html'

    def form_valid(self, form):
        form.instance.author = self.request.user
        return super().form_valid(form)

# 게시글 수정
class PostUpdateView(LoginRequiredMixin, UserPassesTestMixin, UpdateView):
    model = Post
    form_class = PostForm
    template_name = 'blog/post_form.html'

    def test_func(self):
        post = self.get_object()
        return self.request.user == post.author

# 게시글 삭제
class PostDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = Post
    template_name = 'blog/post_confirm_delete.html'
    success_url = reverse_lazy('blog:post_list')

    def test_func(self):
        post = self.get_object()
        return self.request.user == post.author

# 태그별 게시글 목록
class PostByTagListView(ListView):
    model = Post
    template_name = 'blog/post_list_by_tag.html'
    context_object_name = 'posts'
    paginate_by = 10

    def get_queryset(self):
        self.tag = get_object_or_404(Tag, slug=self.kwargs['slug'])
        return Post.objects.filter(
            tags=self.tag,
            is_published=True
        ).select_related('author').prefetch_related('tags')

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['tag'] = self.tag
        return context

# 댓글 작성
class CommentCreateView(LoginRequiredMixin, CreateView):
    model = Comment
    form_class = CommentForm
    http_method_names = ['post']

    def form_valid(self, form):
        post = get_object_or_404(Post, pk=self.kwargs['post_pk'])
        form.instance.author = self.request.user
        form.instance.post = post
        return super().form_valid(form)

    def get_success_url(self):
        return self.object.post.get_absolute_url()

# 댓글 수정
class CommentUpdateView(LoginRequiredMixin, UserPassesTestMixin, UpdateView):
    model = Comment
    form_class = CommentForm
    template_name = 'blog/comment_form.html'

    def test_func(self):
        comment = self.get_object()
        return self.request.user == comment.author

    def get_success_url(self):
        return self.object.post.get_absolute_url()

# 댓글 삭제
class CommentDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = Comment
    template_name = 'blog/comment_confirm_delete.html'

    def test_func(self):
        comment = self.get_object()
        return self.request.user == comment.author

    def get_success_url(self):
        return self.object.post.get_absolute_url()
```

### 2. accounts 앱 뷰 작성 (인증)
```python
# accounts/views.py
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.views import LoginView as DjangoLoginView, LogoutView as DjangoLogoutView
from django.views.generic import CreateView
from django.urls import reverse_lazy

class SignUpView(CreateView):
    form_class = UserCreationForm
    template_name = 'accounts/signup.html'
    success_url = reverse_lazy('accounts:login')

class LoginView(DjangoLoginView):
    template_name = 'accounts/login.html'
    redirect_authenticated_user = True

class LogoutView(DjangoLogoutView):
    next_page = 'main:home'
```

---

## URL 설정

### 1. 프로젝트 URL 설정
```python
# config/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('main.urls')),
    path('accounts/', include('accounts.urls')),
]
```

### 2. main 앱 URL 설정
```python
# main/urls.py (새로 생성)
from django.urls import path
from . import views

app_name = 'main'

urlpatterns = [
    path('', views.HomeView.as_view(), name='home'),
    path('about/', views.AboutView.as_view(), name='about'),
    path('contact/', views.ContactView.as_view(), name='contact'),
]
```

### 3. blog URL 설정 (main/urls.py에 추가할 수도 있지만, 분리하여 관리)
```python
# main/urls.py 수정 (또는 blog/urls.py 새로 생성)
from django.urls import path
from . import views

app_name = 'main'

urlpatterns = [
    # 기본 페이지
    path('', views.HomeView.as_view(), name='home'),
    path('about/', views.AboutView.as_view(), name='about'),
    path('contact/', views.ContactView.as_view(), name='contact'),
]

# blog URL patterns
blog_patterns = [
    path('blog/', views.PostListView.as_view(), name='post_list'),
    path('blog/create/', views.PostCreateView.as_view(), name='post_create'),
    path('blog/<int:pk>/', views.PostDetailView.as_view(), name='post_detail'),
    path('blog/<int:pk>/update/', views.PostUpdateView.as_view(), name='post_update'),
    path('blog/<int:pk>/delete/', views.PostDeleteView.as_view(), name='post_delete'),
    path('blog/tag/<str:slug>/', views.PostByTagListView.as_view(), name='post_by_tag'),
    path('blog/<int:post_pk>/comment/create/', views.CommentCreateView.as_view(), name='comment_create'),
    path('blog/comment/<int:pk>/update/', views.CommentUpdateView.as_view(), name='comment_update'),
    path('blog/comment/<int:pk>/delete/', views.CommentDeleteView.as_view(), name='comment_delete'),
]

urlpatterns += blog_patterns

# app_name을 'blog'로 사용하고 싶다면:
# app_name = 'blog'로 변경하고 위의 blog_patterns를 urlpatterns에 직접 추가
```

### 4. accounts 앱 URL 설정
```python
# accounts/urls.py (새로 생성)
from django.urls import path
from . import views

app_name = 'accounts'

urlpatterns = [
    path('signup/', views.SignUpView.as_view(), name='signup'),
    path('login/', views.LoginView.as_view(), name='login'),
    path('logout/', views.LogoutView.as_view(), name='logout'),
]
```

---

## 템플릿 작성

### 1. 템플릿 폴더 구조 생성
```bash
# main 앱 템플릿
mkdir main\templates
mkdir main\templates\main
mkdir main\templates\blog

# accounts 앱 템플릿
mkdir accounts\templates
mkdir accounts\templates\accounts
```

폴더 구조:
```
main/
├── templates/
│   ├── main/
│   │   ├── home.html
│   │   ├── about.html
│   │   ├── base.html
│   │   └── contact.html
│   └── blog/
│       ├── post_list.html
│       ├── post_detail.html
│       ├── post_form.html
│       ├── post_confirm_delete.html
│       ├── post_list_by_tag.html
│       ├── comment_form.html
│       └── comment_confirm_delete.html
accounts/
├── templates/
│   └── accounts/
│       ├── signup.html
│       └── login.html
```

### 2. 베이스 템플릿 작성
```html
<!-- main/templates/main/base.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Django 블로그{% endblock %}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        nav {
            background-color: #2c3e50;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: #34495e;
        }
        .nav-left, .nav-right {
            display: flex;
        }
        .content {
            min-height: calc(100vh - 200px);
            padding: 2rem 0;
        }
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav>
        <div class="container">
            <div class="nav-left">
                <a href="{% url 'main:home' %}">홈</a>
                <a href="{% url 'main:about' %}">소개</a>
                <a href="{% url 'main:contact' %}">연락처</a>
                <a href="{% url 'main:post_list' %}">블로그</a>
            </div>
            <div class="nav-right">
                {% if user.is_authenticated %}
                    <a href="{% url 'main:post_create' %}">글쓰기</a>
                    <span style="color: white; padding: 0.5rem 1rem;">{{ user.username }}님</span>
                    <form method="post" action="{% url 'accounts:logout' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" style="background: none; border: none; color: white; cursor: pointer; padding: 0.5rem 1rem;">
                            로그아웃
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'accounts:login' %}">로그인</a>
                    <a href="{% url 'accounts:signup' %}">회원가입</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container content">
        {% block content %}
        {% endblock %}
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 Django 블로그. All rights reserved.</p>
        </div>
    </footer>

    {% block extra_js %}{% endblock %}
</body>
</html>
```

### 3. 홈 페이지 템플릿
```html
<!-- main/templates/main/home.html -->
{% extends 'main/base.html' %}

{% block title %}홈 - Django 블로그{% endblock %}

{% block content %}
<h1>Django 블로그에 오신 것을 환영합니다!</h1>
<p>이 블로그는 Django CBV를 사용하여 만들어졌습니다.</p>
<p>로그인, 회원가입, 게시글 작성/수정/삭제, 댓글 작성/수정/삭제, 마크다운 지원 등의 기능을 제공합니다.</p>
<br>
<a href="{% url 'main:post_list' %}" class="btn btn-primary">블로그 보러가기</a>
{% endblock %}
```

### 4. 게시글 목록 템플릿
```html
<!-- main/templates/blog/post_list.html -->
{% extends 'main/base.html' %}

{% block title %}게시글 목록 - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .post-list {
        list-style: none;
    }
    .post-item {
        background-color: #f8f9fa;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }
    .post-item h2 {
        margin-bottom: 0.5rem;
    }
    .post-item h2 a {
        color: #2c3e50;
        text-decoration: none;
    }
    .post-item h2 a:hover {
        color: #3498db;
    }
    .post-meta {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    .post-tags {
        margin-top: 0.5rem;
    }
    .tag {
        display: inline-block;
        background-color: #3498db;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        font-size: 0.85rem;
        text-decoration: none;
        margin-right: 0.25rem;
    }
    .tag:hover {
        background-color: #2980b9;
    }
    .pagination {
        display: flex;
        justify-content: center;
        list-style: none;
        margin-top: 2rem;
    }
    .pagination a {
        padding: 0.5rem 1rem;
        margin: 0 0.25rem;
        background-color: #ecf0f1;
        color: #2c3e50;
        text-decoration: none;
        border-radius: 4px;
    }
    .pagination a:hover {
        background-color: #bdc3c7;
    }
</style>
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>게시글 목록</h1>
    {% if user.is_authenticated %}
    <a href="{% url 'main:post_create' %}" class="btn btn-primary">새 글 작성</a>
    {% endif %}
</div>

{% if posts %}
    <ul class="post-list">
        {% for post in posts %}
        <li class="post-item">
            <h2><a href="{% url 'main:post_detail' post.pk %}">{{ post.title }}</a></h2>
            <div class="post-meta">
                작성자: {{ post.author.username }} | 작성일: {{ post.created_at|date:"Y년 m월 d일 H:i" }}
            </div>
            <div class="post-tags">
                {% for tag in post.tags.all %}
                <a href="{% url 'main:post_by_tag' tag.slug %}" class="tag">{{ tag.name }}</a>
                {% endfor %}
            </div>
        </li>
        {% endfor %}
    </ul>

    {% if is_paginated %}
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; 처음</a>
        <a href="?page={{ page_obj.previous_page_number }}">이전</a>
        {% endif %}

        <span style="padding: 0.5rem 1rem;">
            페이지 {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">다음</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">마지막 &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <p>게시글이 없습니다.</p>
{% endif %}
{% endblock %}
```

### 5. 게시글 상세 템플릿
```html
<!-- main/templates/blog/post_detail.html -->
{% extends 'main/base.html' %}
{% load markdown_extras %}

{% block title %}{{ post.title }} - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .post-header {
        border-bottom: 2px solid #ecf0f1;
        padding-bottom: 1rem;
        margin-bottom: 2rem;
    }
    .post-title {
        margin-bottom: 0.5rem;
    }
    .post-meta {
        color: #7f8c8d;
        font-size: 0.9rem;
    }
    .post-tags {
        margin-top: 0.5rem;
    }
    .tag {
        display: inline-block;
        background-color: #3498db;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        font-size: 0.85rem;
        text-decoration: none;
        margin-right: 0.25rem;
    }
    .post-content {
        line-height: 1.8;
        margin-bottom: 2rem;
    }
    .post-actions {
        margin-bottom: 2rem;
    }
    .comments-section {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid #ecf0f1;
    }
    .comment {
        background-color: #f8f9fa;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
    }
    .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        color: #7f8c8d;
    }
    .comment-actions {
        margin-top: 0.5rem;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<article>
    <div class="post-header">
        <h1 class="post-title">{{ post.title }}</h1>
        <div class="post-meta">
            작성자: <strong>{{ post.author.username }}</strong> |
            작성일: {{ post.created_at|date:"Y년 m월 d일 H:i" }} |
            수정일: {{ post.updated_at|date:"Y년 m월 d일 H:i" }}
        </div>
        <div class="post-tags">
            {% for tag in post.tags.all %}
            <a href="{% url 'main:post_by_tag' tag.slug %}" class="tag">{{ tag.name }}</a>
            {% empty %}
            <span style="color: #7f8c8d; font-size: 0.85rem;">태그 없음</span>
            {% endfor %}
        </div>
    </div>

    <div class="post-content">
        {{ post.content|markdown|safe }}
    </div>

    <div class="post-actions">
        <a href="{% url 'main:post_list' %}" class="btn btn-secondary">목록으로</a>
        {% if user == post.author %}
        <a href="{% url 'main:post_update' post.pk %}" class="btn btn-primary">수정</a>
        <a href="{% url 'main:post_delete' post.pk %}" class="btn btn-danger">삭제</a>
        {% endif %}
    </div>
</article>

<section class="comments-section">
    <h2>댓글 ({{ post.comments.count }})</h2>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'main:comment_create' post.pk %}" style="margin: 2rem 0;">
        {% csrf_token %}
        <div class="form-group">
            {{ comment_form.content }}
        </div>
        <button type="submit" class="btn btn-primary">댓글 작성</button>
    </form>
    {% else %}
    <p><a href="{% url 'accounts:login' %}">로그인</a>하시면 댓글을 작성할 수 있습니다.</p>
    {% endif %}

    <div style="margin-top: 2rem;">
        {% for comment in post.comments.all %}
        <div class="comment">
            <div class="comment-header">
                <span><strong>{{ comment.author.username }}</strong> | {{ comment.created_at|date:"Y년 m월 d일 H:i" }}</span>
            </div>
            <div class="comment-content">
                {{ comment.content|linebreaks }}
            </div>
            {% if user == comment.author %}
            <div class="comment-actions">
                <a href="{% url 'main:comment_update' comment.pk %}" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">수정</a>
                <a href="{% url 'main:comment_delete' comment.pk %}" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">삭제</a>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p style="color: #7f8c8d;">첫 댓글을 작성해보세요!</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
```

### 6. 게시글 작성/수정 폼 템플릿
```html
<!-- main/templates/blog/post_form.html -->
{% extends 'main/base.html' %}

{% block title %}
{% if form.instance.pk %}게시글 수정{% else %}게시글 작성{% endif %} - Django 블로그
{% endblock %}

{% block extra_css %}
<style>
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    .form-check {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<h1>{% if form.instance.pk %}게시글 수정{% else %}게시글 작성{% endif %}</h1>

<form method="post">
    {% csrf_token %}

    <div class="form-group">
        <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
        {{ form.title }}
        {% if form.title.errors %}
        <div class="alert alert-error">{{ form.title.errors }}</div>
        {% endif %}
    </div>

    <div class="form-group">
        <label for="{{ form.content.id_for_label }}">{{ form.content.label }}</label>
        {{ form.content }}
        <small style="color: #7f8c8d;">마크다운 문법을 사용할 수 있습니다.</small>
        {% if form.content.errors %}
        <div class="alert alert-error">{{ form.content.errors }}</div>
        {% endif %}
    </div>

    <div class="form-group">
        <label>{{ form.tags.label }}</label>
        {{ form.tags }}
        {% if form.tags.errors %}
        <div class="alert alert-error">{{ form.tags.errors }}</div>
        {% endif %}
    </div>

    <div class="form-group">
        <div class="form-check">
            {{ form.is_published }}
            <label for="{{ form.is_published.id_for_label }}">{{ form.is_published.label }}</label>
        </div>
        {% if form.is_published.errors %}
        <div class="alert alert-error">{{ form.is_published.errors }}</div>
        {% endif %}
    </div>

    <div>
        <button type="submit" class="btn btn-primary">
            {% if form.instance.pk %}수정 완료{% else %}작성 완료{% endif %}
        </button>
        <a href="{% if form.instance.pk %}{% url 'main:post_detail' form.instance.pk %}{% else %}{% url 'main:post_list' %}{% endif %}" class="btn btn-secondary">취소</a>
    </div>
</form>
{% endblock %}
```

### 7. 게시글 삭제 확인 템플릿
```html
<!-- main/templates/blog/post_confirm_delete.html -->
{% extends 'main/base.html' %}

{% block title %}게시글 삭제 - Django 블로그{% endblock %}

{% block content %}
<h1>게시글 삭제</h1>

<div class="alert alert-error" style="margin: 2rem 0;">
    <p><strong>정말로 이 게시글을 삭제하시겠습니까?</strong></p>
    <p>제목: <strong>{{ post.title }}</strong></p>
    <p>이 작업은 되돌릴 수 없습니다.</p>
</div>

<form method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">삭제</button>
    <a href="{% url 'main:post_detail' post.pk %}" class="btn btn-secondary">취소</a>
</form>
{% endblock %}
```

### 8. 댓글 수정 폼 템플릿
```html
<!-- main/templates/blog/comment_form.html -->
{% extends 'main/base.html' %}

{% block title %}댓글 수정 - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<h1>댓글 수정</h1>

<form method="post">
    {% csrf_token %}

    <div class="form-group">
        {{ form.content }}
        {% if form.content.errors %}
        <div class="alert alert-error">{{ form.content.errors }}</div>
        {% endif %}
    </div>

    <div>
        <button type="submit" class="btn btn-primary">수정 완료</button>
        <a href="{{ comment.post.get_absolute_url }}" class="btn btn-secondary">취소</a>
    </div>
</form>
{% endblock %}
```

### 9. 댓글 삭제 확인 템플릿
```html
<!-- main/templates/blog/comment_confirm_delete.html -->
{% extends 'main/base.html' %}

{% block title %}댓글 삭제 - Django 블로그{% endblock %}

{% block content %}
<h1>댓글 삭제</h1>

<div class="alert alert-error" style="margin: 2rem 0;">
    <p><strong>정말로 이 댓글을 삭제하시겠습니까?</strong></p>
    <p>내용: {{ comment.content|truncatewords:20 }}</p>
    <p>이 작업은 되돌릴 수 없습니다.</p>
</div>

<form method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">삭제</button>
    <a href="{{ comment.post.get_absolute_url }}" class="btn btn-secondary">취소</a>
</form>
{% endblock %}
```

### 10. 태그별 게시글 목록 템플릿
```html
<!-- main/templates/blog/post_list_by_tag.html -->
{% extends 'main/base.html' %}

{% block title %}{{ tag.name }} 태그 - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .post-list {
        list-style: none;
    }
    .post-item {
        background-color: #f8f9fa;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }
    .post-item h2 {
        margin-bottom: 0.5rem;
    }
    .post-item h2 a {
        color: #2c3e50;
        text-decoration: none;
    }
    .post-item h2 a:hover {
        color: #3498db;
    }
    .post-meta {
        color: #7f8c8d;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<h1>'{{ tag.name }}' 태그의 게시글</h1>

{% if posts %}
    <ul class="post-list">
        {% for post in posts %}
        <li class="post-item">
            <h2><a href="{% url 'main:post_detail' post.pk %}">{{ post.title }}</a></h2>
            <div class="post-meta">
                작성자: {{ post.author.username }} | 작성일: {{ post.created_at|date:"Y년 m월 d일 H:i" }}
            </div>
        </li>
        {% endfor %}
    </ul>
{% else %}
    <p>이 태그에 해당하는 게시글이 없습니다.</p>
{% endif %}

<a href="{% url 'main:post_list' %}" class="btn btn-secondary">전체 목록으로</a>
{% endblock %}
```

### 11. 회원가입 템플릿
```html
<!-- accounts/templates/accounts/signup.html -->
{% extends 'main/base.html' %}

{% block title %}회원가입 - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 500px;
        margin: 0 auto;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .helptext {
        display: block;
        color: #7f8c8d;
        font-size: 0.85rem;
        margin-top: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1>회원가입</h1>

    <form method="post">
        {% csrf_token %}

        {% for field in form %}
        <div class="form-group">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% if field.help_text %}
            <span class="helptext">{{ field.help_text|safe }}</span>
            {% endif %}
            {% if field.errors %}
            <div class="alert alert-error">{{ field.errors }}</div>
            {% endif %}
        </div>
        {% endfor %}

        <div>
            <button type="submit" class="btn btn-primary">가입하기</button>
            <a href="{% url 'main:home' %}" class="btn btn-secondary">취소</a>
        </div>
    </form>

    <p style="margin-top: 1rem;">
        이미 계정이 있으신가요? <a href="{% url 'accounts:login' %}">로그인</a>
    </p>
</div>
{% endblock %}
```

### 12. 로그인 템플릿
```html
<!-- accounts/templates/accounts/login.html -->
{% extends 'main/base.html' %}

{% block title %}로그인 - Django 블로그{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 500px;
        margin: 0 auto;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1>로그인</h1>

    {% if form.errors %}
    <div class="alert alert-error">
        아이디 또는 비밀번호가 올바르지 않습니다.
    </div>
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.username.id_for_label }}">사용자명</label>
            {{ form.username }}
        </div>

        <div class="form-group">
            <label for="{{ form.password.id_for_label }}">비밀번호</label>
            {{ form.password }}
        </div>

        <div>
            <button type="submit" class="btn btn-primary">로그인</button>
            <a href="{% url 'main:home' %}" class="btn btn-secondary">취소</a>
        </div>
    </form>

    <p style="margin-top: 1rem;">
        계정이 없으신가요? <a href="{% url 'accounts:signup' %}">회원가입</a>
    </p>
</div>
{% endblock %}
```

### 13. 소개 페이지 템플릿
```html
<!-- main/templates/main/about.html -->
{% extends 'main/base.html' %}

{% block title %}소개 - Django 블로그{% endblock %}

{% block content %}
<h1>소개</h1>
<p>이것은 Django CBV(Class Based View)로 만든 블로그입니다.</p>
<p>다음과 같은 기능을 제공합니다:</p>
<ul>
    <li>회원가입 및 로그인/로그아웃</li>
    <li>게시글 작성, 수정, 삭제</li>
    <li>게시글 목록 조회 및 상세 보기</li>
    <li>댓글 작성, 수정, 삭제</li>
    <li>태그 기능</li>
    <li>마크다운 지원</li>
</ul>
{% endblock %}
```

### 14. 연락처 페이지 템플릿
```html
<!-- main/templates/main/contact.html -->
{% extends 'main/base.html' %}

{% block title %}연락처 - Django 블로그{% endblock %}

{% block content %}
<h1>연락처</h1>
<p>Email: contact@example.com</p>
<p>GitHub: https://github.com/example</p>
{% endblock %}
```

---

## 마크다운 지원 설정

### 1. templatetags 폴더 생성
```bash
mkdir main\templatetags
```

### 2. __init__.py 생성
* main\templatetags\__init__.py 파일 생성(빈파일)

### 3. 마크다운 템플릿 필터 작성
```python
# main/templatetags/markdown_extras.py
from django import template
import markdown as md
from markdown.extensions.fenced_code import FencedCodeExtension
from markdown.extensions.codehilite import CodeHiliteExtension

register = template.Library()

@register.filter(name='markdown')
def markdown_format(text):
    """마크다운 텍스트를 HTML로 변환"""
    return md.markdown(
        text,
        extensions=[
            'fenced_code',
            'codehilite',
            'tables',
            'nl2br',
        ]
    )
```

---

## 정적 파일 설정

### 1. settings.py에 정적 파일 설정 추가
```python
# config/settings.py

import os

# Static files (CSS, JavaScript, Images)
STATIC_URL = '/static/'
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static'),
]
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# Media files (User uploaded files)
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
```

---

## 최종 테스트

### 1. 서버 실행
```bash
python manage.py runserver
```

### 2. 테스트 시나리오

#### 2.1 회원가입 및 로그인
1. http://127.0.0.1:8000/accounts/signup/ 접속
2. 회원가입 진행
3. http://127.0.0.1:8000/accounts/login/ 에서 로그인

#### 2.2 게시글 작성
1. http://127.0.0.1:8000/blog/create/ 접속
2. 마크다운 문법으로 게시글 작성 예시:
```markdown
# 제목입니다

이것은 **굵은 글씨**이고, 이것은 *기울임*입니다.

## 코드 블록
```python
def hello():
    print("Hello, Django!")
```

## 리스트
- 항목 1
- 항목 2
- 항목 3
```

#### 2.3 댓글 작성
1. 게시글 상세 페이지에서 댓글 작성
2. 자신의 댓글 수정/삭제 테스트

#### 2.4 게시글 수정 및 삭제
1. 자신이 작성한 게시글 수정
2. 자신이 작성한 게시글 삭제

#### 2.5 태그 필터링
1. 태그 클릭하여 해당 태그의 게시글만 보기

#### 2.6 권한 테스트
1. 다른 사용자로 로그인하여 타인의 게시글 수정/삭제 시도 (403 에러 발생 확인)
2. 로그아웃 후 게시글 작성 시도 (로그인 페이지로 리다이렉트 확인)

---

## 추가 개선 사항 (선택)

### 1. 페이지네이션 개선
```python
# main/views.py의 PostListView 수정
class PostListView(ListView):
    paginate_by = 10
    paginate_orphans = 3  # 마지막 페이지에 3개 이하면 이전 페이지에 합침
```

### 2. 검색 기능 추가
```python
# main/views.py에 추가
from django.db.models import Q

class PostListView(ListView):
    def get_queryset(self):
        queryset = super().get_queryset()
        search = self.request.GET.get('search', '')
        if search:
            queryset = queryset.filter(
                Q(title__icontains=search) | Q(content__icontains=search)
            )
        return queryset
```

### 3. 프로필 페이지 추가
- 사용자별 게시글 목록
- 사용자별 댓글 목록

---

## 최종 URL 목록

```
/ : 홈 페이지
/about/ : 소개 페이지
/contact/ : 연락처 페이지
/accounts/signup/ : 회원가입
/accounts/login/ : 로그인
/accounts/logout/ : 로그아웃
/blog/ : 게시글 목록
/blog/create/ : 게시글 작성
/blog/<pk>/ : 게시글 상세
/blog/<pk>/update/ : 게시글 수정
/blog/<pk>/delete/ : 게시글 삭제
/blog/tag/<slug>/ : 특정 태그 게시글 목록
/blog/<post_pk>/comment/create/ : 댓글 작성
/blog/comment/<pk>/update/ : 댓글 수정
/blog/comment/<pk>/delete/ : 댓글 삭제
/admin/ : 관리자 페이지
```

---

## 완료!

이제 로그인, 로그아웃, 회원가입, 게시글 CRUD, 댓글 CRUD, 마크다운 지원이 모두 포함된 Django 블로그 웹 애플리케이션이 완성되었습니다!

모든 뷰는 CBV(Class Based View) 방식으로 구현되었으며, 권한 관리를 위해 LoginRequiredMixin과 UserPassesTestMixin을 사용했습니다.
